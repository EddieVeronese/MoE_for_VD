## How to replicate 

### About the Environment Setup
First of all, create a python environment with the following commands:
```
python3 -m venv venv
source venv/bin/activate
```

Then install the python dependencies via the following command:
```
pip install -r requirements.txt
```

### About the files
This folder is organized into 5 scripts:

analyze_class_CWE.py: This script analyzes the relationship between CWE classes and clusters by computing the observed-to-expected ratio for each class-cluster combination, highlighting strong over- or under-representations.

analyze_cluster.py: This script evaluates the correlation between clusters and each dataset column, using chi-squared tests for categorical features and standard deviation for numerical ones, reporting the strength of association or variation.

analyze_CWE_id.py: This script groups CWE IDs into 8 clusters using KMeans based on their distribution across existing clusters, then computes and highlights over- or under-representation of these CWE groups in each cluster.

cluster.py: This script generates CodeBERT embeddings for each function in a dataset, clusters them into 8 groups using KMeans, saves the cluster assignments, and prints a few example functions from each cluster.

create_new_cluster.py: This script maps each CWE ID to its dominant cluster, updates all dataset splits with this new cluster label, and then saves both the full updated datasets and separate subset files for each cluster.

### About the Experiment Replication  
  
  
  To download all the datasets used in the experiments, follow the commands below
  ```
  cd datasets
  gdown metti link
  cd ..
  ```

#### How to create clusters
To create clusters download the desired dataset, set his name at line 8 of the script ```cluster.py``` and then run the following commands, for example:
  ```
  cd datasets
 gdown https://drive.google.com/uc?id=1W66CvbtEbcDxJkffZN-Bt9Mh3n7TyQN-
  cd ..
  python cluster.py
  ```

This will create a csv named "clustered" inside the main project folder. 

To create the datasets for clustered now you need to load into dataset your datasets already divided into train, test and val set their names inside the ```create_new_cluster.py``` at line 18 file as shown in the following commands:
```
cd datasets
gdown https://drive.google.com/uc?id=1BVkWfc-AJk5kT5T-R3nCLfhcCoc77e9X
gdown https://drive.google.com/uc?id=1koqk0H2vmXwSaErq921R6SMT5uGHj4-z
cd ..
python create_new_cluster.py
```
At the end the various cluster CSV files will be created in the main project folder.



#### How to analyze clusters
You can analyze clusters with the following commands, which take as input the csv file generated by ```cluster.py```:
```
  python analyze_class_CWE.py
  python analyze_cluster.py
  python analyze_CWE_id.py
  ```